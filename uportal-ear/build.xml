<project name="uPortal-ear" basedir=".">
    <taskdef resource="net/sf/antcontrib/antcontrib.properties">
        <classpath>
            <pathelement location="../bootstrap/ant-contrib-1.0b3.jar" />
        </classpath>
    </taskdef>

    <target name="assemblePortlets">
        <echo message="plugin classpath:  ${plugin_classpath}"/>
        
        <foreach target="assembleWar" param="warFile">
            <path>
                <fileset dir="target">
                    <include name="**/*.war" />
                </fileset>
            </path>
        </foreach>
    </target>

    <target name="assembleWar">
        <tempfile property="tempWarDir" prefix="${warFile}." suffix=".tmp"/>
                
        <echo message="Assembling: ${warFile} to: ${tempWarDir}" />
        
        <java fork="true" failonerror="true" dir="${basedir}" classname="org.danann.cernunnos.runtime.Main">
            <classpath>
                <pathelement path="target/classes" />
                <path refid="plugin_classpath" />
            </classpath>

            <arg value="classpath://org/jasig/portal/container/deploy/deploy-archives.crn" />
            <arg value="${warFile}" />
            
            <arg value="${tempWarDir}" />
        </java>
        <!--
            Use maven to depend on cernunnos jar?
            Make 'uportal-assembler' sub-project with cernunnos dependency and scripts?
        
            run cernunos deployer to tempdir
            re-war from tempdir over original file
        -->
    </target>
</project>
