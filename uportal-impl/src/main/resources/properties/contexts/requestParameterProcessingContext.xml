<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright (c) 2000-2009, Jasig, Inc.
    See license distributed with this file and available online at
    https://www.ja-sig.org/svn/jasig-parent/tags/rel-10/license-header.txt

-->
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">
    
    <bean id="portalRequestUtils" class="org.jasig.portal.url.PortalRequestUtilsImpl" />

    <bean id="requestParameterProcessorController" class="org.jasig.portal.url.processing.RequestParameterProcessorListController">
        <property name="dynamicRequestParameterProcessors">
            <list value-type="org.jasig.portal.url.processing.IRequestParameterProcessor">
                <!-- <ref local="urlParameterProcessor" />  -->
                <ref local="userLayoutParameterProcessor" />
                <ref local="portletRequestParameterProcessor" />
                <ref local="channelRequestParameterProcessor" />
            </list>
        </property>
    </bean>
    
    <!-- 
     | Use UrlRequestParameterProcessor to pull structure and theme parameters 
     | from arbitrary elements of the request URL.  The following example sets 
     | the 'activeTab' structure parameter based on the first logical directory 
     |  after 'uPortal/'
     |
     | E.g. given a request URL of
     |   - http://localhost:8080/uPortal/foo/render.userLayoutRootNode.uP
     | The value of 'activeTab' would be 
     |   - foo
     +-->
    <!-- 
    <bean id="urlParameterProcessor" class="org.jasig.portal.url.processing.UrlRequestParameterProcessor">
        <property name="userInstanceManager" ref="userInstanceManager" />
        <property name="structureParameters">
            <map>
                <entry key="activeTab">
                    <value>[^/]*//[^/]*/uPortal/([^/]*)/</value>
                </entry>
            </map>
        </property>
    </bean>
     -->

    <bean id="userLayoutParameterProcessor" class="org.jasig.portal.url.processing.UserLayoutParameterProcessor">
        <property name="userInstanceManager" ref="userInstanceManager" />
    </bean>
    
    <bean id="portletRequestParameterProcessor" class="org.jasig.portal.url.processing.PortletRequestParameterProcessor">
        <property name="portletRequestParameterManager" ref="portletRequestParameterManager" />
        <property name="portletUrlSyntaxProvider" ref="portletUrlSyntaxProvider" />
        <property name="portletWindowRegistry" ref="portletWindowRegistry" />
    </bean>
    
    <bean id="channelRequestParameterProcessor" class="org.jasig.portal.url.processing.ChannelRequestParameterProcessor">
        <property name="userInstanceManager" ref="userInstanceManager" />
        <property name="portletRequestParameterManager" ref="portletRequestParameterManager" />
        <property name="channelRequestParameterManager" ref="channelRequestParameterManager" />
        <property name="portalUrlProvider" ref="portalUrlProvider"/>
        <property name="maxUploadSize">
            <bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
                <property name="targetClass" value="org.jasig.portal.properties.PropertiesManager" />
                <property name="targetMethod" value="getPropertyAsInt" />
                <property name="arguments">
                    <list>
                        <value>org.jasig.portal.RequestParamWrapper.file_upload_max_size</value>
                        <value>3000000</value>
                    </list>
                </property>
            </bean>
        </property>
    </bean>
    
    <bean id="channelRequestParameterManager" class="org.jasig.portal.url.support.ChannelRequestParameterManager" />
    
    <bean id="portletRequestParameterManager" class="org.jasig.portal.portlet.url.PortletRequestParameterManager">
        <property name="portalRequestUtils" ref="portalRequestUtils" />
    </bean>
</beans>
